#!/bin/bash

set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables

ERRAND_NAME=bootstrap

export HOME=/var/vcap
echo "Started bootstrap errand ..."


cat >> bootstrap_config.yml <<EOF
HealthcheckURLs:
 <% p('cluster_ips').each do |ip| %>
 - http://<%= ip %>:<%= p('healthcheck_port') %>
 <% end %>
EOF

  /var/vcap/packages/bootstrap/bin/cf-mysql-bootstrap \
    -configPath=bootstrap_config.yml

echo "Successfully bootstrapped"
exit 0
