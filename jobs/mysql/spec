---
name: mysql

templates:
  mariadb_ctl.erb: bin/mariadb_ctl
  my.cnf.erb: config/my.cnf
  mariadb_ctl_config.yml.erb: config/mariadb_ctl_config.yml
  mariadb_init.erb: config/mariadb_init
  syslog_forwarder.conf.erb: config/syslog_forwarder.conf
  mysql_audit_logs.logrotate.erb: config/mysql_audit_logs.logrotate

packages:
- mariadb
- mariadb_ctrl
- cf-mysql-common
- syslog_aggregator

consumes:
- name: mysql
  type: mysql

provides:
- name: mysql
  type: mysql

properties:
  syslog_aggregator.address:
    description: "IP address for syslog aggregator"
  syslog_aggregator.port:
    description: "TCP port of syslog aggregator"
  syslog_aggregator.all:
    description: "Define whether forwarders should also send non-mysql syslog activity to the aggregator."
    default: false
  syslog_aggregator.transport:
    description: "Transport to be used when forwarding logs (tcp|udp|relp)."
    default: "tcp"

  admin_password:
    description: 'Password for the MySQL server admin user'
  port:
    description: 'Port the mysql server should bind to'
    default: 3306
  max_connections:
    description: 'Maximum total number of database connections for the node'
    default: 1500
  max_open_files:
    description: 'Configure this number to be comfortably larger than the maximum number of tables you expect the database to support. Max is 104xxxx.'
    default: 65536
  innodb_buffer_pool_size:
    description: 'Optional, the size in bytes of the memory buffer InnoDB uses to cache data and indexes of its tables'
  innodb_buffer_pool_instances:
    description: 'Optional, number of buffer pool instances for InnoDB used if innodb_buffer_pool_size > 1GB'
  innodb_lock_wait_timeout:
    description: 'Optional, time in seconds that an InnoDB transaction waits for an InnoDB row lock'
  max_heap_table_size:
    description: 'The maximum size (in rows) to which user-created MEMORY tables are permitted to grow'
    default: 16777216
  tmp_table_size:
    description: 'The maximum size (in bytes) of internal in-memory temporary tables'
    default: 33554432
  skip_name_resolve:
    description: 'Do not restrict connections to database based on hostname'
    default: true

  ib_log_file_size:
    description: 'Size of the ib_log_file used by innodb, in MB'
    default: 1024
  seeded_databases:
    description: 'Set of databases to seed'
    default: {}
    example: |
      - name: db1
        username: user1
        password: pw1
      - name: db2
        username: user2
        password: pw2
  roadmin_enabled:
    description: 'Whether read only user is enabled'
    default: false
  roadmin_password:
    description: 'Password for the MySQL server read-only admin user'
  server_audit_events:
    description: 'Enable audit logging and specify types of events that will be logged. If null, then logging is disabled'
    example: 'connect,query_ddl,query_dml,query_dcl'
  server_audit_file_rotations:
    default: 30
    description: 'Number of audit file rotations to keep'
  server_audit_file_rotate_size_in_mb:
    default: 100
    description: 'Size in MB of each audit log file'
  server_audit_excluded_users:
    description: 'Other database users to exclude from audit logging'
    default: []
    example: |
      - monitoring_user
      - other_excluded_user
      - bot_user
  database_startup_timeout:
    description: 'How long the startup script waits for the database to come online (in seconds)'

  binlog_enabled:
    default: true
    description: 'Enable binlogs across all nodes'
  binlog_expire_days:
    default: 60
    description: 'Time in days to store binlogs before purging'
