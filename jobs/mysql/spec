---
name: mysql

templates:
  mariadb_ctl.erb: bin/mariadb_ctl
  my.cnf.erb: config/my.cnf
  mylogin.cnf.erb: config/mylogin.cnf
  mariadb_ctl_config.yml.erb: config/mariadb_ctl_config.yml
  mariadb_init.erb: config/mariadb_init
  galera-healthcheck_ctl.erb: bin/galera-healthcheck_ctl
  galera_healthcheck_config.yaml.erb: config/galera_healthcheck_config.yaml
  galera_healthcheck_setup.sql.erb: config/galera_healthcheck_setup.sql
  gra-log-purger_ctl.erb: bin/gra-log-purger_ctl
  gra-log-purger.sh.erb: bin/gra-log-purger.sh
  syslog_forwarder.conf.erb: config/syslog_forwarder.conf
  cluster_health_logger_ctl.erb: bin/cluster_health_logger_ctl
  cluster_health_logger_config.yml.erb: config/cluster_health_logger_config.yml
  cluster_health_logger_setup.sql.erb: config/cluster_health_logger_setup.sql

packages:
- xtrabackup
- mariadb
- mariadb_ctrl
- galera
- galera-healthcheck
- gra-log-purger
- golang
- common
- syslog_aggregator
- cf-mysql-cluster-health-logger

properties:
  admin_username:
    description: 'Username for the MySQL server admin user'
    default: 'root'
  admin_password:
    description: 'Password for the MySQL server admin user'
  port:
    description: 'Port the mysql server should bind to'
    default: 3306
  max_connections:
    description: 'Maximum total number of database connections for the node'
    default: 1500
  innodb_buffer_pool_size:
    description: 'The size in bytes of the memory buffer InnoDB uses to cache data and indexes of its tables'
  cluster_ips:
    description: 'List of nodes.  Must have the same number of ips as there are nodes in the cluster'
  max_heap_table_size:
    description: 'The maximum size (in rows) to which user-created MEMORY tables are permitted to grow'
    default: 16777216
  tmp_table_size:
    description: 'The maximum size (in bytes) of internal in-memory temporary tables'
    default: 33554432
  wsrep_max_ws_rows:
    description: 'Maximum permitted number of rows per writeset.'
    default: 131072
  wsrep_max_ws_size:
    description: 'Maximum permitted size in bytes per writeset.'
    default: 1073741824

  #these two properties are also used by the Broker
  gcache_size:
    description: 'Cache size used by galera (maximum amount of data possible in an IST), in MB'
    default: 512
  ib_log_file_size:
    description: 'Size of the ib_log_file used by innodb, in MB'
    default: 1024
  seeded_databases:
    description: 'Set of databases to seed'
    default: {}

  syslog_aggregator.address:
    description: "IP address for syslog aggregator"
  syslog_aggregator.port:
    description: "TCP port of syslog aggregator"
  syslog_aggregator.all:
    description: "Define whether forwarders should also send non-mysql syslog activity to the aggregator."
    default: false
  syslog_aggregator.transport:
    description: "Transport to be used when forwarding logs (tcp|udp|relp)."
    default: "tcp"

  database_startup_timeout:
    description: 'How long the startup script waits for the database to come online (in seconds)'

  cf_mysql.mysql.cluster_health.log_interval:
    description: 'Time in seconds between log entries for cluster health'
    default: 30
  cf_mysql.mysql.cluster_health.password:
    description: 'Password for the cluster logger health user'

  cf_mysql.mysql.galera_healthcheck.endpoint_username:
    description: 'Username used by the sidecar endpoints for Basic Auth'
  cf_mysql.mysql.galera_healthcheck.endpoint_password:
    description: 'Password used by the sidecar endpoints for Basic Auth'
  cf_mysql.mysql.galera_healthcheck.db_password:
    description: 'Password used by the sidecar to connect to the database'

  cf_mysql.mysql.disable_auto_sst:
    description: 'When disable_auto_sst is true, nodes unable to IST will be prevented from automatically deleting their data and performing an SST'
    default: true
  cf_mysql.mysql.binlog_enabled:
    default: true
    description: 'Enable binlogs across all nodes'
  cf_mysql.mysql.binlog_expire_days:
    default: 60
    description: 'Time in days to store binlogs before purging'
  cf_mysql.mysql.log_conflicts:
    default: true
    description: 'Defines whether the node logs additional information about conflicts. The values that were in conflict are logged, so it is possible for user data to end up in the logs.'

  cf_mysql.mysql.server_audit_events:
    description: 'Enable audit logging and specify types of events that will be logged. If null, then logging is disabled'
    example: 'connect,query'
  cf_mysql.mysql.server_audit_file_rotations:
    default: 30
    description: 'Number of audit file rotations to keep'
  cf_mysql.mysql.server_audit_file_rotate_size_in_mb:
    default: 100
    description: 'Size in MB of each audit log file'
